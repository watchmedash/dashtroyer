<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime Gallery</title>
  <link rel="stylesheet" href="anime.css">
</head>
<body>
  <header>
    <h1>Anime Gallery</h1>
  </header>

  <div id="anime-gallery" class="anime-gallery"></div>

  <button id="load-more" class="load-more-btn">Load More</button>

  <script>
    let currentPage = 1;  // Starting page number for pagination
    const limit = 20;  // Number of animes per page

    // Function to fetch a paginated list of anime from MyAnimeList
    async function fetchAnimeList(page) {
      try {
        const response = await fetch(`https://api.allorigins.win/get?url=https://api.myanimelist.net/v2/anime/ranking?limit=${limit}&page=${page}`);
        // Check if the response is OK
        if (!response.ok) {
          throw new Error('Failed to fetch data from MyAnimeList');
        }
        const data = await response.json();
        return data.data || [];  // Return empty array if no data is available
      } catch (error) {
        console.error('Error fetching anime data:', error);
        return [];  // Return empty array on error
      }
    }

    // Function to populate the gallery with anime posters
    async function populateGallery(page) {
      const animeList = await fetchAnimeList(page);
      const galleryContainer = document.getElementById('anime-gallery');
      const loadMoreButton = document.getElementById('load-more');

      if (animeList.length === 0) {
        galleryContainer.innerHTML = '<p>Sorry, we could not load the anime list. Please try again later.</p>';
        loadMoreButton.disabled = true;  // Disable "Load More" button if no more data
        return;
      }

      animeList.forEach((anime) => {
        const animeElement = document.createElement('div');
        animeElement.classList.add('anime-item');
        animeElement.innerHTML = `
          <img src="${anime.images.jpg.large_image_url}" alt="${anime.title}" />
          <p>${anime.title}</p>
        `;
        animeElement.addEventListener('click', () => {
          window.location.href = `anime-details.html?malid=${anime.mal_id}`;
        });
        galleryContainer.appendChild(animeElement);
      });

      // Show the "Load More" button
      loadMoreButton.style.display = 'block';
    }

    // Event listener for the "Load More" button
    document.getElementById('load-more').addEventListener('click', () => {
      currentPage++;
      populateGallery(currentPage);
    });

    // Initial population of the gallery
    populateGallery(currentPage);
  </script>
</body>
</html>
